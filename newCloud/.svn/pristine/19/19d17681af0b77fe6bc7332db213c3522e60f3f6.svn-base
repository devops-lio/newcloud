var submitFlag=false;
var returnFlag=false;
var chargeIsStop=false;
var updateSubmitCheck=false;
var divNum;//获得焦点的未停用的div按钮
var divUseNum;//获得焦点的启用的div按钮
var updateNum;//获得未停用div修改按钮焦点
var comb=true;
var addStr='<input type="text" class="newAppNum" value="" placeholder="如:138211" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" maxlength="7" >';
var dang=0;
//var hasChargePrice=0;
$(function() {
	// 用户信息下拉菜单
	$('.admin').click(function(){
		var str=$('.menu').css('display');
		if(str=='none'){
			$('.menu').css('display','block');
		}else{
			$('.menu').css('display','none');
		}
	});
	// 退出按钮
	$('.menu > li.exit').click(function(){
		window.location.href=ctx+"/logOut";
	});
	$('html').contextmenu(function(){
		return false;
	});
	$(".icon-seek").click(function(){
		SitePriceConfigList();
	});
	buffer();
	//checkout();
	numdisp(dang);
	SitePriceConfigList();
	//getTotalPage();
	init();//初始化
	//新增计费绑定按钮
	$('.charging .appendNum').click(function(){
		$('.charging .appendNum').before(addStr);
		 $(".charging .comboNumList>input").blur(function () {
			 var inputResult=[];
			 var thisIndex=$('.charging .comboNumList>input').index(this);//当前失去焦点input的下标   -----用以排除当前元素value
			  $(".charging .comboNumList>input").each(function(){
				inputResult.push($(this).val());
			 });
			  if($(this).val()!=""){
				  for(var i=0;i<inputResult.length-1;i++){
					  if(inputResult[i]!="" && i!=thisIndex){
						  if(inputResult[i]==$(this).val()){
							  $(this).val("");
							  $(".win>span").html("您输入的号码段重复");
							  winHint();
							  return false;
						  }
					  }
				  }
				 
			  }
				 
		});
		checkCom();
	});
	
	//修改页面新增计费绑定按钮
	$('.amend .appendNum').click(function(){
		$('.amend .comboNumList .appendNum').before(addStr);
		 $(".amend .comboNumList>input").blur(function () {
			 var inputResult=[];
			 var thisIndex=$('.amend .comboNumList>input').index(this);//当前失去焦点input的下标   -----用以排除当前元素value
			  $(".amend .comboNumList>input").each(function(){
				inputResult.push($(this).val());
			 });
			  if($(this).val()!=""){
				  for(var i=0;i<inputResult.length-1;i++){
					  if(inputResult[i]!="" && i!=thisIndex){
						  if(inputResult[i]==$(this).val()){
							  $(this).val("");
							  $(".win>span").html("您输入的号码段重复");
							  winHint();
							  return false;
						  }
					  }
				  }
			  }
			 
		});
		 checkRepeat();
	});
	
	//归属集团绑定按钮
	$('.group').click(function(){
		if($('.group>ul').css('display')=='none'){
			$('.group>ul').css('display','block');
		}else{
			$('.group>ul').css('display','none');
		}
	});
	//归属集团选择绑定按钮
	$('.group>ul>li').click(function(){
		$('.group>ul').css('display','none');
		var n=$('.group>ul>li').index(this);
		var str=$('.group>ul>li').eq(n).html();
		$("#charge_attach").val($('.group>ul>li').eq(n).attr("value"));
		$('.group>span').html(str);
		return false;
	});
	
	$('.LorR').click(function(){
		var n=$('.LorR').index(this);
		var obj=$('.fessType>ul');
		var one=$('.fessType>ul>li').width();
		var zong=obj.width();
		var move=parseInt(obj.css('left'));
		if(n==1){
			dang++;
			if(dang>5){
				dang=5;
			}else{
				obj.animate({left:-dang*one});
			}
		}else{
			dang--;
			if(dang<0){
				dang=0;
			}else{
				obj.animate({left:-dang*one});
			}
		}
	});
	
	//新增页面归属集团绑定按钮
//	$('.teamGroup').click(function(){
//		var str=$('.teamGroup>ul').css('display');
//		if(str=='block'){
//			$('.teamGroup>ul').css('display','none');
//		}else{
//			$('.teamGroup>ul').css('display','block');
//		}
//	});
//	$('.teamGroup>ul>li').click(function(){
//		var obj=$('.teamGroup>button');
//		var n=$('.teamGroup>ul>li').index(this);
//		var str=$('.teamGroup>ul>li').eq(n).html();
//		
//		$("#charge_type").val($('.teamGroup>ul>li').eq(n).attr("value"));
//		$('.teamGroup>ul').css('display','none');
//		obj.html(str);
//		return false;
//	});
	//新增计费页面归属集团绑定按钮
	$('.bloc').click(function(){
		if($('.blocList').css('display')=="none"){
			$('.blocList').css('display','block');
		}else{
			$('.blocList').css('display','none');
		}
	});
	//新增计费选择时间单位绑定按钮
	$('.charging .payMold>span').click(function(){
		if($('.payList').css('display')=="none"){
			$('.payList').css('display','block');
		}else{
			$('.payList').css('display','none');
		}
	});
	//启用和未启用按钮绑定
	$('.state>li').click(function(){
		var n=$('.state>li').index(this);
		$('.state>li').removeClass('on').eq(n).addClass('on');
		$('.stateList').css('display','none').eq(n).css('display','block');
		var val=$('.state>li').eq(1).attr("value");
		//val为0时调用查询方法,1的时候不在调用
		if(n==1&&val==0){
			$('.state>li').eq(1).attr("value","1");
			$(".blockList .fuseCombo").remove();
			$(".blockList .notFuseCombo").remove();
				getStopedPrice();
		}
		
	});
	//是否实行绑定按钮
	$('.yesOrNo').click(function(){
		var lang=$('.yesOrNo').length;
		var n=$('.yesOrNo').index(this);
		var str=$('.yesOrNo').eq(n).attr('class');
		if(n==lang-3){
			if("yesOrNo"==str){
				on_off(str,n);
				charge_on_off(str);
				
			}else{
				$('.yesOrNo').eq(1).addClass('on');
				$('.operator').css('display','none');
				on_off(str,n);
				charge_on_off(str);
				$(".fn-btn").attr("disabled", false);
			}
			
		}else if(n==lang-2){
			if("yesOrNo"==str){
				on_off(str,n);
				fuse_on_off(str);
			}else{
				on_off(str,n);
				fuse_on_off(str);
			}
			
		}else{
			on_off(str,n);
			PackageDetails_on_off(str);
		}
	});
	$('.goLeft').click(function(){
		dang--;
		if(dang<0){
			dang=0;
			numdisp(dang);
		}else{
			buffer();
			$('.num').removeClass('on').eq(dang).addClass('on');
			var nowPage=$('.num').eq(dang).html();
			SitePriceConfigList(nowPage);
			numdisp(dang);
		}
	});
	$('.goRight').click(function(){
		dang++;
		if(dang>$('.num').length-1){
			dang=$('.num').length-1;
			numdisp(dang);
		}else{
			buffer();
			$('.num').removeClass('on').eq(dang).addClass('on');
			var nowPage=$('.num').eq(dang).html();
			SitePriceConfigList(nowPage);
			numdisp(dang);
		}
	});
});

function init(){
	
//	$(".yesOrNo").eq(2).addClass("on");
//	$('.PackageDetails').css('display','none');
	
}
function fuse_on_off(str){
	if(str=="yesOrNo"){
		$(".PackageDetails").css('display','none');
		$('.fuse>.yesOrNo').addClass('on');
		$('.operator').css('display','none');
	}else{
		$('.fuse>.yesOrNo').removeClass('on');
		$('.operator').css('display','block');
		$(".PackageDetails").css('display','block');
	}
}
function charge_on_off(str){
	if(str=="yesOrNo"){
		
		$('.import').css('display','none');
		$('.fuse').css('display','none');
	}else{
		$(".PackageDetails").css('display','block');
		$('.import').css('display','block');
		
	}
}
function PackageDetails_on_off(str){
	if(str=="yesOrNo"){
		$('.PackageDetails').css('display','none');
	}else{
		$('.PackageDetails').css('display','block');
	}
}
function on_off(str,n){
	if(str=="yesOrNo"){
		$('.yesOrNo').eq(n).addClass('on');
	}else{
		$('.yesOrNo').eq(n).removeClass('on');
	}
	
}
function newPage(n){
	if(n!=0){
		$('.whether').css('display','block');
		
	}
};
//场所查询绑定回车事件
function goFindSite(e){
	var e=e||window.event;
    if (e.keyCode == 13) {
    	buffer();
    	SitePriceConfigList();
    	//getTotalPage();
    } 
	
}
function selAll(){
	buffer();
	SitePriceConfigList();
	//getTotalPage();
}

//获取分页列表
function SitePriceConfigList(){
	var selectVal  =$(".college").val().trim();
//	if("全部查询"==selectVal){
//		selectVal=-1;
//	}
//	if (num == undefined)
//		return;
//	if (isNaN(num))
//		return;
	$.ajax({
		type : "POST",
		url :ctx+ "/SitePriceBilling/getSitePriceConfigList",
		data : {
			siteName:selectVal
		},
		success :function(data){
			eval("data = " + data);
			if(data.code==1){
				getTable(data);
				var id=	$('#ulConfig .on').attr("value");
				getPrice(id);
				
				$("#ulConfig>li").click(function(){
					$('.floa').css('display','none');
					buffer();
					var n=$('#ulConfig>li').index(this);
					if(n!=0){
						$('#ulConfig>li').removeClass('on').eq(n).addClass('on');
						$('.timeType').removeClass('on').eq(0).addClass('on');
						$(".siteName").html($("#ulConfig>.on >span").eq(0).html());
						$(".siteAddress").html($("#ulConfig>.on>span").eq(1).html());
						$('.state>li').removeClass('on').eq(0).addClass('on');
						$('.stateList').css('display','none').eq(0).css('display','block');
						
					}
					$("#hasChargeType").val("0");
					$('.state>li').eq(1).attr("value","0");
					var id=$("#ulConfig>li.on").attr("value");
					getPrice(id);
				});
			}else if(data.code=2){
				$(".win>span").html("没有查到此场所");
				winHint();
			}else{
				$(".win>span").html(data.msg);
				winHint();
			}
		}
	});
}
//生成列表start
function getTable(data){
	$(".siteTable").remove();
	var lihtml="";
	for(var i = 0;i<data.data.length;i++){
			lihtml+="<li class='siteTable' value="+data.data[i].id+"><span title='"+data.data[i].site_name+"'>"+data.data[i].site_name+"</span><span title='"+data.data[i].address+"'>"+data.data[i].address+"</span><i class='icon icon-left'></i></li>";
	}
	$("#firstLi").after(lihtml);
	$(".siteTable").eq(0).addClass("on");
	$(".siteName").html($(".on >span").eq(0).html());
	$(".siteAddress").html($(".on>span").eq(1).html());
}
//获取未停用付费类型 时,日,月
function getPrice(id){
	$.ajax({
		type:"POST",
		url:ctx+"/SitePriceBilling/getUserSiteNoStopedPayType",
		data:{
			sendTime: (new Date()).getTime(),
			uId:id
		},
		success: function(data){
			eval("data = " + data);
			if(data.code==200){
				getUserPrice(data);
				addNewPage();
			}else{
				$(".win>span").html("该场所下未设置套餐,请添加收费套餐");
				win();
			}
			
		}
	});
}

//获取已停用付费类型 时,日,月
function getStopedPrice(){
	var id=$("#ulConfig>li.on").attr("value");
	$.ajax({
		type:"POST",
		url:ctx+"/SitePriceBilling/getUserSiteIsStopedPayType",
		data:{
			sendTime: (new Date()).getTime(),
			uId:id
		},
		success: function(data){
			eval("data = " + data);
			if(data.code==200){
				getUserStopedPrice(data);
				addNewPage();
			}else{
				$(".blockList .fuseCombo").remove();
				$(".win>span").html("该场所下无停用的套餐");
				winHint();
			}
			
		}
	});
}
//获得已停用套餐价格列表
function getUserStopedPrice(data){
	$(".move").attr("style",0);
	var priceHtml="";
	
	for(var i=0;i<data.data.length;i++){
		for(var j=i+1;j<data.data.length;j++){
			if(data.data[i].name==data.data[j].name&&data.data[i].comboNumber!=data.data[j].comboNumber&&data.data[i].name!=undefined&&data.data[j].name!=undefined){
				if(data.data[i].comboNumber==undefined){	
					priceHtml+="<div class='fuseCombo'><span class='on'><label>启&nbsp;用</label></span>";
					priceHtml+="<div class='chargeInfo'>";
					priceHtml+="<p class='priceStopedName' value="+data.data[i].price_num+" payType="+data.data[i].price_type+">计费名称：<span>"+data.data[i].name+"</span></p>";
					priceHtml+="<p class='lastStopedPrice'>普通收费：<span>"+data.data[i].unit_price+"元</span></p>";
					priceHtml+="<ul>";
					if(data.data[j].charge_type==1){
						priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>电信集团</span></li>";
					}
					if(data.data[j].charge_type==2){
						priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>移动集团</span></li>";
					}
					if(data.data[j].charge_type==3){
						priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>联通集团</span></li>";
					}
					priceHtml+="<li class='dnseg' title="+data.data[j].comboNumber.replace(/;/g , ',').substring(0,data.data[j].comboNumber.length-1)+">套餐号段：<span>"+data.data[j].comboNumber.replace(/;/g , ',').substring(0,data.data[j].comboNumber.length-1)+"</span></li>";
				}
				if(data.data[j].comboNumber==undefined){
					priceHtml+="<div class='fuseCombo'><span class='on'><label>启&nbsp;用</label></span>";
					priceHtml+="<div class='chargeInfo'>";
					priceHtml+="<p class='priceStopedName' value="+data.data[j].price_num+" payType="+data.data[j].price_type+">计费名称：<span>"+data.data[j].name+"</span></p>";
					priceHtml+="<p class='lastStopedPrice'>普通收费：<span>"+data.data[j].unit_price+"元</span></p>";
					priceHtml+="<ul>";
					if(data.data[i].charge_type==1){
						priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>电信集团</span></li>";
					}
					if(data.data[i].charge_type==2){
						priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>移动集团</span></li>";
					}
					if(data.data[i].charge_type==3){
						priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
						priceHtml+="<li>所属集团：<span>联通集团</span></li>";
					}
					priceHtml+="<li class='dnseg' title="+data.data[i].comboNumber.replace(/;/g , ',').substring(0,data.data[i].comboNumber.length-1)+">套餐号段：<span>"+data.data[i].comboNumber.replace(/;/g , ',').substring(0,data.data[i].comboNumber.length-1)+"</span></li>";
				}
				priceHtml+="</ul>";
				priceHtml+="</div>";
				priceHtml+="<em class='edit'><i class='icon icon-edit'></i></em>";
				/*priceHtml+="<em class='delete'><i class='icon icon-trash'></i></em>";*///删除按钮暂不开放
				priceHtml+="</div>";
			}
			$(".blockList").html(priceHtml);
			break;;
		}
	}
	var reu=data.data;
	for(var i=0;i<reu.length;i++){
		for(var j=i+1;j<reu.length;j++){
			if(reu[i]!=undefined&&reu[j]!=undefined){
				if(reu[i].name==reu[j].name&&reu[i].comboNumber!=reu[j].comboNumber){
					delete reu[i];
					delete reu[j];
					break;
				}
			}
		}
	}
	for(var i=0;i<reu.length;i++){
		if(reu[i]!=undefined){
			
			priceHtml+="<div class='notFuseCombo'><span class='on'><label>启&nbsp;用</label></span>" +
			"<div class='chargeInfo'>"+
			"<p class='priceStopedName' value="+reu[i].price_num+" payType="+reu[i].price_type+">计费名称：<span>"+reu[i].name+"</span></p>"+
			"<p class='lastStopedPrice'>普通收费：<span>"+reu[i].unit_price+"元</span></p>"+
		"</div>"+
		"<em class='edit'><i class='icon icon-edit'></i></em>"+
		/*"<em class='delete'><i class='icon icon-trash'></i></em>"+*///删除按钮暂不开放
		"</div>";
		}
		$(".blockList").html(priceHtml);
	}
		wouldClick();
	
}

//获得未停用套餐价格列表
function getUserPrice(data){
	$(".useList .fuseCombo").remove();
	$(".useList .notFuseCombo").remove();
	$(".move").attr("style",0);
	var priceHtml="";
		for(var i=0;i<data.data.length;i++){
			for(var j=i+1;j<data.data.length;j++){
				if(data.data[i].name==data.data[j].name&&data.data[i].comboNumber!=data.data[j].comboNumber&&data.data[i].name!=undefined&&data.data[j].name!=undefined){
					if(data.data[i].comboNumber==undefined){	
						priceHtml+="<div class='fuseCombo'><span class='on'><label>停&nbsp;用</label></span>";
						priceHtml+="<div class='chargeInfo'>";
						priceHtml+="<p class='priceName' value="+data.data[i].price_num+" payType="+data.data[i].price_type+">计费名称：<span>"+data.data[i].name+"</span></p>";
						priceHtml+="<p class='lastPrice'>普通收费：<span>"+data.data[i].unit_price+"元</span></p>";
						priceHtml+="<ul>";
						if(data.data[j].charge_type==1){
							priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>电信集团</span></li>";
						}
						if(data.data[j].charge_type==2){
							priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>移动集团</span></li>";
						}
						if(data.data[j].charge_type==3){
							priceHtml+="<li id='chargeLi' value="+data.data[j].charge_type+">套餐收费：<span>"+data.data[j].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>联通集团</span></li>";
						}
						priceHtml+="<li class='dnseg' title="+data.data[j].comboNumber.replace(/;/g , ',').substring(0,data.data[j].comboNumber.length-1)+">套餐号段：<span>"+data.data[j].comboNumber.replace(/;/g , ',').substring(0,data.data[j].comboNumber.length-1)+"</span></li>";
					}
					if(data.data[j].comboNumber==undefined){
						priceHtml+="<div class='fuseCombo'><span class='on'><label>停&nbsp;用</label></span>";
						priceHtml+="<div class='chargeInfo'>";
						priceHtml+="<p class='priceName' value="+data.data[j].price_num+" payType="+data.data[j].price_type+">计费名称：<span>"+data.data[j].name+"</span></p>";
						priceHtml+="<p class='lastPrice'>普通收费：<span>"+data.data[j].unit_price+"元</span></p>";
						priceHtml+="<ul>";
						if(data.data[i].charge_type==1){
							priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>电信集团</span></li>";
						}
						if(data.data[i].charge_type==2){
							priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>移动集团</span></li>";
						}
						if(data.data[i].charge_type==3){
							priceHtml+="<li id='chargeLi' value="+data.data[i].charge_type+">套餐收费：<span>"+data.data[i].unit_price+"元</span></li>";
							priceHtml+="<li>所属集团：<span>联通集团<span/></li>";
						}
						priceHtml+="<li class='dnseg' title="+data.data[i].comboNumber.replace(/;/g , ',').substring(0,data.data[i].comboNumber.length-1)+">套餐号段：<span>"+data.data[i].comboNumber.replace(/;/g , ',').substring(0,data.data[i].comboNumber.length-1)+"</span></li>";
					}
					priceHtml+="</ul>";
					priceHtml+="</div>";
					priceHtml+="<em class='edit'><i class='icon icon-edit'></i></em>";
					/*priceHtml+="<em class='delete'><i class='icon icon-trash'></i></em>";*///删除按钮暂不开放
					priceHtml+="</div>";
				}
				$(".useList").html(priceHtml);
				break;;
			}
		}
		var reu=data.data;
		for(var i=0;i<reu.length;i++){
			for(var j=i+1;j<reu.length;j++){
				if(reu[i]!=undefined&&reu[j]!=undefined){
					if(reu[i].name==reu[j].name&&reu[i].comboNumber!=reu[j].comboNumber){
						delete reu[i];
						delete reu[j];
						break;
					}
				}
			}
		}
		for(var i=0;i<reu.length;i++){
			if(reu[i]!=undefined){
				
				priceHtml+="<div class='notFuseCombo'><span class='on'><label>停&nbsp;用</label></span>" +
				"<div class='chargeInfo'>"+
				"<p class='priceName' value="+reu[i].price_num+" payType="+reu[i].price_type+">计费名称：<span>"+reu[i].name+"</span></p>"+
				"<p class='lastPrice'>普通收费：<span>"+reu[i].unit_price+"元</span></p>"+
			"</div>"+
			"<em class='edit'><i class='icon icon-edit'></i></em>"+
			/*"<em class='delete'><i class='icon icon-trash'></i></em>"+*///删除按钮暂不开放
			"</div>";
			}
			$(".useList").html(priceHtml);
		}
		wouldClick();
	
}
//生成未停用融合套餐价格和非融合套餐价格
//function getValue(){
//	var typeNum=$(".useList>div>div>p.priceName>span").length;
//	for(var i=0;i<typeNum;i++){
//		var name=$(".useList>div>div>p.priceName>span").eq(i).text();
//		var id=$("#ulConfig .on").attr("value");
//		$.ajax({
//			type:"POST",
//			async:false,
//			url:ctx+"/SitePriceBilling/selByName",
//			data:{
//				name:name,
//				siteId:id
//			},
//			success:function(data){
//				eval("data="+data);
//				if(data.code==200){
//							var comboNumber=data.data[0].comboNumber.replace(/;/g , ',');
//							var htmlPrice="";
//							htmlPrice+="<ul>";
//							htmlPrice+="<li id='chargeLi' value="+data.data[0].charge_type	+">套餐收费：<span>"+data.data[0].unit_price+"元</span></li>";
//							if(data.data[0].charge_type==1){htmlPrice+="<li>所属集团：<span>电信集团</span></li>";}
//							if(data.data[0].charge_type==2){htmlPrice+="<li>所属集团：<span>移动集团</span></li>";}
//							if(data.data[0].charge_type==3){htmlPrice+="<li>所属集团：<span>联通集团</span></li>";}
//							htmlPrice+="<li class='dnseg' title="+comboNumber.substring(0,comboNumber.length-1)+">套餐号段：<span>"+comboNumber.substring(0,comboNumber.length-1)+"</span></li>";
//							htmlPrice+="</ul>";
//							$(".fuseCombo>.chargeInfo>p.lastPrice").eq(i).after(htmlPrice);
//							return false;
//				}else{
//					return false;
//				}
//			},
//		});
//	}
//}

//生成已停用融合套餐价格和非融合套餐价格
//function getStopedValue(){
//	var typeNum=$(".blockList>div>div>p.priceStopedName>span").length;
//	for(var i=0;i<typeNum;i++){
//		var name=$(".blockList>div>div>p.priceStopedName>span").eq(i).text();
//		var id=$("#ulConfig .on").attr("value");
//		$.ajax({
//			type:"POST",
//			async:false,
//			url:ctx+"/SitePriceBilling/selStopedByName",
//			data:{
//				name:name,
//				siteId:id
//			},
//			success:function(data){
//				eval("data="+data);
//				if(data.code==200){
//							var comboNumber=data.data[0].comboNumber.replace(/;/g , ',');
//							var htmlPrice="";
//							htmlPrice+="<ul>";
//							htmlPrice+="<li id='chargeLi' value="+data.data[0].charge_type	+">套餐收费：<span>"+data.data[0].unit_price+"元</span></li>";
//							if(data.data[0].charge_type==1){htmlPrice+="<li>所属集团：<span>电信集团</span></li>";}
//							if(data.data[0].charge_type==2){htmlPrice+="<li>所属集团：<span>移动集团</span></li>";}
//							if(data.data[0].charge_type==3){htmlPrice+="<li>所属集团：<span>联通集团</span></li>";}
//							htmlPrice+="<li class='dnseg' title="+comboNumber.substring(0,comboNumber.length-1)+">套餐号段：<span>"+comboNumber.substring(0,comboNumber.length-1)+"</span></li>";
//							htmlPrice+="</ul>";
//							$(".fuseCombo>.chargeInfo>p.lastStopedPrice").eq(i).after(htmlPrice);
//							return false;
//				}else{
//					return false;
//				}
//			}
//		});
//	}
//}

//弹出新的增加收费类型的页面
function addNewPage(){
	//新增计费按钮绑定
	$(".newAdd").unbind("click");
	$(".newAdd").click(function(){
		findIsStop();
	});
	//付费类型 时,日,月按钮绑定
	$('.timeType').click(function(){
		$('.floa').css('display','none');
		var moveW=$('.move').width();
		typeDang=$('.timeType').index(this);
		$('.timeType').removeClass('on').eq(typeDang).addClass('on');
		$('.move').animate({left:moveW*typeDang+'px'});
		if($("#priceUl .on").attr("isstop")==1){
			$('.import').css('display','none');
			$('.fuse').css('display','none');
			$(".yesOrNo").eq(0).addClass("on");
		}else{
			$('.import').css('display','block');
			$('.fuse').css('display','block');
			$(".yesOrNo").eq(0).removeClass("on");
		}
		$("#hasChargeType").val("0");
		buffer();
		getValue();
		wouldClick();
		
	});
	//新增页面付费单位按钮绑定
	$('.charging .payList>li').click(function(){
		var n=$('.charging .payList>li').index(this);
		var str=$('.charging .payList>li').eq(n).html();
		var type=$('.charging .payList>li').eq(n).attr("value");
		$("#price_type").val(type);
		$('.payMold>span').html(str);
		$('.payList').css('display','none');
		return false;
	});
	//新增页面归属集团按钮绑定
	$('.blocList>li').click(function(){
		var n=$('.blocList>li').index(this);
		var str=$('.blocList>li').eq(n).html();
		var chargeTpye=$('.blocList>li').eq(n).attr("value");
		$("#charge_type").val(chargeTpye);
		$('.bloc>span').html(str);
		$('.blocList').css('display','none');
		return false;
	});
}

//点击新增查询开启状态
function findIsStop(){
	var id=$("#ulConfig .on").attr("value");
	$.ajax({
		type:"POST",
		async:false,
		url:ctx+"/SitePriceBilling/findStop",
		data:{
			id:id
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				$('.mask').css('display','block');
				$('.new').css('display','none');
				$('.charging').css('display','block');
				$('.newly').animate({left:'20%'},1000);
				$('.yesOrNo').eq(0).addClass('on');
				$(".PackageDetails").css('display','none');
			}else{
				$(".win>span").html("您的收费套餐超过四个，请先作废其中一个然后添加新的套餐");
				win();
				return;
			}
		}
		
	});
	
}
//点击开启状态,查询是否超过四个
function findOpenStop(){
	returnFlag=false;
	var id=$("#ulConfig .on").attr("value");
	$.ajax({
		type:"POST",
		async:false,
		url:ctx+"/SitePriceBilling/findStop",
		data:{
			id:id
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				returnFlag=true;
				return false;
			}else{
				returnFlag=false;
				$(".win>span").html("您的收费套餐超过四个，请先作废其中一个然后添加新的套餐");
				win();
				return false;
			}
		}
		
	});
	
}
function addFindStop(){
	var id=$("#ulConfig .on").attr("value");
	var name=$("#priceUl .on").text();
	$.ajax({
		type:"POST",
		url:ctx+"/SitePriceBilling/addFindStop",
		async:false,
		data:{
			id:id,
			name:name
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				updateParameter();
			}else{
				$(".win>span").html("您的收费套餐超过四个，请先作废其中一个然后开启套餐");
				win();
			}
		}	
		});	
}


//作废套餐类型
function updateStop(){
	var name=$(".priceName:eq("+divNum+") span").eq(0).text();
	var id=$("#ulConfig .on").attr("value");
	$.ajax({
		type:"POST",
		async:false,
		url:ctx+"/SitePriceBilling/updateIsStop",
		data:{
			name:name,
			id:id
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				removeMeal();
				$(".win>span").html("停用成功");
				winHint();
				return false;
			}else{
				$(".win>span").html("服务不可用,请稍后尝试");
				winHint();
				return false;
				
			}
		}
		
	});
}
//使用套餐类型
function updateNoStop(){
	var name=$(".priceStopedName:eq("+divUseNum+") span").eq(0).text();
	var id=$("#ulConfig .on").attr("value");
	$.ajax({
		type:"POST",
		url:ctx+"/SitePriceBilling/updateNoStop",
		data:{
			name:name,
			id:id
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				removeStopedMeal();
				$(".win>span").html("启用成功");
				winHint();
				return false;
			}else{
				$(".win>span").html("服务不可用,请稍后尝试");
				winHint();
				return false;
			}
		}
		
	});
	
}

//查询融合套餐是否启用
function selchargePrice(){
	var name=$("#priceUl .on").text();
	var id=$("#priceUl .on").attr("siteid");
	$.ajax({
		type:"POST",
		async:false,
		url:ctx+"/SitePriceBilling/selChargeIsStop",
		data:{
			name:name,
			siteId:id
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				$('.yesOrNo').eq(1).removeClass('on');
				$('.operator').css('display','block');
			}else if(data.code==201){
				$('.yesOrNo').eq(1).addClass('on');
				$('.operator').css('display','none');
			}else if(data.code==202){
				$('.yesOrNo').eq(1).addClass('on');
				$('.operator').css('display','none');
			}
			
		}
		
	});
	
}

//提交时校验
function checksubmit(){
	var pName=$(".charging #payName").val();
	var pMoney=$(".charging #payMoney").val();
	var newPayNum=$(".charging #newPayFeel").val();
	if(pName==""||pName==null){
		submitFlag=false;
		$(".win>span").html("收费名称不能为空");
		winHint();
		return;
	}
	if(pMoney==null||pMoney==0){
		submitFlag=false;
		$(".win>span").html("收费单价不能为空或零");
		winHint();
		return;
	}
	if(newPayNum==null||newPayNum==0){
		submitFlag=false;
		$(".win>span").html("收费类型不能为空或零");
		winHint();
		return;
	}
	submitFlag=true;
	return submitFlag;
} 
//提交时校验两个
function checkTwoSubmit(){
	var pName=$(".charging #payName").val();
	var pMoney=$(".charging #payMoney").val();
	var payAmount=$(".charging #payCharge").val();	//融合收费价格
	var newPayNum=$(".charging #newPayFeel").val();
	var comboNumber= "";//套餐号码段
	$(".comboNumList>input").each(function(){
		if($(this).val()!=""){
			comboNumber+=$(this).val()+";";
		}
	});
	if(pName==""||pName==null){
		submitFlag=false;
		$(".win>span").html("收费名称不能为空");
		winHint();
		return;
	}
	if(pMoney==null||pMoney==0){
		submitFlag=false;
		$(".win>span").html("收费单价不能为空或零");
		winHint();
		return;
	}
	if(newPayNum==null||newPayNum==0){
		submitFlag=false;
		$(".win>span").html("收费类型不能为空或零");
		winHint();
		return;
	}
	if(payAmount==null||payAmount==0){
		submitFlag=false;
		$(".win>span").html("套餐收费不能为空或零");
		winHint();
		return;
	}
	if(comboNumber==""||comboNumber.length<3){
		submitFlag=false;
		$(".win>span").html("号码段不能为空或少于三位");
		winHint();
		return;
	}
	submitFlag=true;
	return submitFlag;
} 
$(".comboNumList>input").keyup(function(){
	$(".comboNumList>input").each(function(){
		if($(this).val()==""||$(this).val().length<3){
			submitFlag=false;
			$(".win>span").html("号码段不能为空或少于三位");
			winHint();
			return;
		}
	});
});
//检验输入的长度	
function checkout(){
	submitFlag=true;
	var input = []; 
	//把不为空的放在数组中
	$(".comboNumList>input").each(function(){
		if($(this).val()!=""){
			 input.push($(this).val());
		}
	});
	//遍历不为空的值是否长度小于三位
	for(var i = 0;i<input.length;i++){
		if(input[i].length<3){
			submitFlag=false;
			$(".win>span").html("号码段不能为空或少于三位");
			winHint();
			return;
		}
	}
		return submitFlag;
}
//新增计费
$("#save").click(function(){
	var str=$('.yesOrNo').eq(0).attr("class");
		if(str!='yesOrNo'){
			if(checksubmit()){
				savePayType();
			}
		}else{
			if(checkTwoSubmit()&&checkout()){
				savePayType();
			}
		}
});
//新增收费类型
function savePayType(){
	var comboNumber= "";//套餐号码段
	$(".comboNumList>input").each(function(){
		if($(this).val()!=""){
			comboNumber+=$(this).val()+";";
		}
	});
	if(comboNumber==""){
		comboNumber="1";
	}
	var payNumber=$(".charging #newPayFeel").val();//收费套餐数量
	var payType=$(".charging #price_type").val();//收费类型 时,日,月
	var payAmount=$(".charging #payCharge").val();//融合收费价格
	var payName=$(".charging #payName").val();//收费名称
	var payMoney=$(".charging #payMoney").val();//非融合收费价格
	var site_id=$("#ulConfig .on").attr("value");
	var stoped=0;//是否作废  0不是，1是
	var charge_type=$(".charging #charge_type").val();//融合套餐所属集团
	var hasOrNo=0;
	var str=$('.yesOrNo').eq(0).attr("class");
	if(str=='yesOrNo'){
		hasOrNo=1;
	}
	$.ajax({
		type:"POST",
		url:ctx+"/SitePriceBilling/addprice",
		data:{
			is_stoped :stoped,
			price_type :payType,
			unit_price :payMoney,
			chargePrice:payAmount,
			charge_type:charge_type,
			site_id :site_id,
			name :payName,
			comboNumber:comboNumber,
			price_num :payNumber,
			hasOrNo:hasOrNo
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				$(".charging input").each(function(){
					$(this).val("");
				});
				$("#price_type").val("0");
				$("#charge_type").val("1");
				$(".charging .groupList").html("中国电信");
				$(".charging .payMold>span").html("时");
				$(".charging .appNum").val("");
				$('.fuseAdd>.yesOrNo').eq(0).addClass('on');
				$(".charging .comboNumList>.newAppNum").remove();
				addTable(payAmount,payMoney,payName,comboNumber,charge_type,hasOrNo,payNumber,payType);
				$(".win>span").html("添加成功");
				winHint();
				$('.newly').animate({left:2000},1000);
				$('.whether').css('display','none');
				setTimeout(function(){
					$('.mask').css('display','none');
				},500);
				
			}
			if(data.code==202){
				$(".win>span").html("该套餐已存在,请修改套餐名称");
				win();
				$('.mask').css('display','block');
			}
			if(data.code==201){
				$('.mask').css('display','block');
				$(".win>span").html("服务不可用，请稍后再试");
				winHint();
			};
		}
	});
}
//添加之后的列表
function addTable(payAmount,payMoney,payName,comboNumber,charge_type,hasOrNo,payNumber,payType){
	if(hasOrNo==0){
		var tableHtml="";
		tableHtml+="<div class='notFuseCombo'>"+
		"<span class='on'><label>停&nbsp;用</label></span>"+
			"<div class='chargeInfo'>"+
				"<p class='priceName'  value="+payNumber+" payType="+payType+">计费名称：<span>"+payName+"</span></p>"+
				"<p class='lastPrice'>普通收费：<span>"+payMoney+"元</span></p>"+
			"</div>"+
			"<em class='edit'><i class='icon icon-edit'></i></em>"+
			/*"<em class='delete'><i class='icon icon-trash'></i></em>"+*/
		"</div>";
		$(".useList>div").eq($(".useList>div").length-1).after(tableHtml);
	}else{
	
			var tableHtml="";
			tableHtml+="<div class='fuseCombo'>";
			tableHtml+="<span class='on'><label>停&nbsp;用</label></span>";
			tableHtml+="<div class='chargeInfo'>";
			tableHtml+="<p class='priceName'  value="+payNumber+" payType="+payType+">计费名称：<span>"+payName+"</span></p>";
			tableHtml+="<p class='lastPrice'>普通收费：<span>"+payMoney+"元</span></p>";
			tableHtml+="<ul>";
			if(charge_type==1){
				tableHtml+="<li id='chargeLi' value="+charge_type+">套餐收费：<span>"+payAmount+"元</span></li>";
				tableHtml+="<li><span>所属集团：</span>电信集团</li>";
			}
			if(charge_type==2){
				tableHtml+="<li id='chargeLi' value="+charge_type+">套餐收费：<span>"+payAmount+"元</span></li>";
				tableHtml+="<li><span>所属集团：</span>移动集团</li>";
			}
			if(charge_type==3){
				tableHtml+="<li id='chargeLi' value="+charge_type+">套餐收费：<span>"+payAmount+"元</span></li>";
				tableHtml+="<li><span>所属集团：</span>联通集团</li>";
			}
			tableHtml+="<li class='dnseg' title="+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+">套餐号段：<span>"+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+"</span></li>";
			tableHtml+="</ul>";
			tableHtml+="</div>";
			tableHtml+="<em class='edit'><i class='icon icon-edit'></i></em>";
		/*	tableHtml+="<em class='delete'><i class='icon icon-trash'></i></em>";*/
			tableHtml+="</div>";
		$(".useList>div").eq($(".useList>div").length-1).after(tableHtml);
	};
	wouldClick();
}
function getComboNumber(data){
	
	var selNumber="";
	var arr=[];
	var numberHtml="";
	for(var i=0;i<data.data.length;i++){
		if(data.data[i].comboNumber!=null){
			selNumber=data.data[i].comboNumber;
		}
	}
	$("#comboValue").val(selNumber);
	arr=selNumber.split(";");
	for(var i =0;i<arr.length-1;i++){
		numberHtml+="<li>"+arr[i]+"</li>";
	};
	$("#comboNumber").html(numberHtml);
}
$(".floa>input").keyup(function(){
	var val=$(".floa>input").val();
	if(val.length<3){
		$(".win>span").html("号码段长度不能少于三位");
		winHint();
		$("#SureAddCombo").attr("disabled", true);
	}else{
		$("#SureAddCombo").attr("disabled", false);
	}
	
});
//修改号码段
$("#SureAddCombo").click(function(){
	var checkCom=true;
	var newComboNumber= $(".floa>input").val();
	var oldComboNumber=$("#comboValue").val();
	for(var j =0;j<oldComboNumber.split(";").length-1;j++){
		if(oldComboNumber.split(";")[j]==newComboNumber){
			checkCom=false;
			$(".win>span").html("号码段不能相同");
			win();
			return;
		}
	}
	if(checkCom){
		if(newComboNumber!=""&&newComboNumber!=null ){
			$("#comboValue").val(oldComboNumber+newComboNumber+";");
		}
		var comboNumber=$("#comboValue").val();
		var id=$("#priceUl .on").attr("siteid");//场所id
		var priceName=$("#priceUl .on").text();//套餐名称
		var interimCombo=[];
		var numberHtml="";
		interimCombo=comboNumber.split(";");
		for(var i =0;i<interimCombo.length-1;i++){
			numberHtml+="<li>"+interimCombo[i]+"</li>";
		};
		$("#comboNumber").html(numberHtml);
		$(".floa>input").val("");
	}
});

//修改绑定确定按钮
$(".amend .btns button:eq(0)").click(function(){
	if("yesOrNo"!=$('.yesOrNo').eq(1).attr("class")){
		if(updateCheck()){
			$('.wether').css('display','block');
		}
	}else{
		if(updateTwoCheck()){
			$('.wether').css('display','block');
		}
	}
});
//修改绑定取消按钮
$(".amend .btns button:eq(1)").click(function(){
	$('.whether').css('display','block');
});
//添加绑定取消按钮
$(".charging .btns button:eq(1)").click(function(){
	$('.whether').css('display','block');
});
//更改时校验
function updateCheck(){
	var noChargePrice=$("#copyPrice").val();//非融合套餐价格
	var priceTypeNum=$(".amend>ul>.payMold>input").val();//非融合套餐收费类型
	if(noChargePrice==0||noChargePrice==null){
		updateSubmitCheck=false;
		$(".win>span").html("非融合套餐价格不能为空");
		win();
		return;
	}
	if(priceTypeNum==0||priceTypeNum==null){
		updateSubmitCheck=false;
		$(".win>span").html("收费类型不能为空");
		winHint();
		return;
	}
	updateSubmitCheck=true;
	return updateSubmitCheck;
}
//更改时校验两个
function updateTwoCheck(){
	var noChargePrice=$("#copyPrice").val();//非融合套餐价格
	var priceTypeNum=$(".amend>ul>.payMold>input").val();//非融合套餐收费类型
	var chargePrice=$(".amend .setMeal input").val();//融合套餐收费价格
	var comboNumber= "";//套餐号码段
	
	$(".amend .comboNumList input").each(function(){
		if($(this).val()!=""){
			comboNumber+=$(this).val()+";";
		}
	});
	if(noChargePrice==0||noChargePrice==null){
		updateSubmitCheck=false;
		$(".win>span").html("非融合套餐价格不能为空");
		winHint();
		return;
	}
	if(priceTypeNum==0||priceTypeNum==null){
		updateSubmitCheck=false;
		$(".win>span").html("收费类型不能为空");
		winHint();
		return;
	}
	if(chargePrice==0||chargePrice==null){
		updateSubmitCheck=false;
		$(".win>span").html("融合套餐价格不能为空");
		winHint();
		return;
	}
	if("无归属"==$(".amend .groupList").html()){
		updateSubmitCheck=false;
		$(".win>span").html("请选择归属集团");
		winHint();
		return;
	}
	if(comboNumber==""){
		updateSubmitCheck=false;
		$(".win>span").html("号码段不能为空");
		winHint();
		return;
	}
	updateSubmitCheck=true;
	return updateSubmitCheck;
	
}
//修改号码段时,校验重复
function checkCom(){
	$(".charging .comboNumList>input").blur(function () {
		var inputResult=[];
		var thisIndex=$('.charging .comboNumList>input').index(this);//当前失去焦点input的下标   -----用以排除当前元素value
		$(".charging .comboNumList>input").each(function(){
			inputResult.push($(this).val());
		});
		if($(this).val()!=""){
			for(var i=0;i<inputResult.length;i++){
				if($(this).val().length<=2){
					$(this).val("");
					$(".win>span").html("您输入的号码段长度不能少于三位");
					winHint();
					return false;
				}else{
					
					if(inputResult[i]!="" && i!=thisIndex){
						if(inputResult[i]==$(this).val()){
							$(this).val("");
							$(".win>span").html("您输入的号码段重复");
							winHint();
							return false;
						}
					}
				}
			}
		}
	});
}
function checkRepeat(){
	$(".amend .comboNumList>input").blur(function () {
		var inputResult=[];
		var thisIndex=$('.amend .comboNumList>input').index(this);//当前失去焦点input的下标   -----用以排除当前元素value
		$(".amend .comboNumList>input").each(function(){
			inputResult.push($(this).val());
		});
		if($(this).val()!=""){
			for(var i=0;i<inputResult.length;i++){
				if($(this).val().length<=2){
					$(this).val("");
					$(".win>span").html("您输入的号码段长度不能少于三位");
					winHint();
					return false;
				}else{
					if(inputResult[i]!="" && i!=thisIndex){
						if(inputResult[i]==$(this).val()){
							$(this).val("");
							$(".win>span").html("您输入的号码段重复");
							winHint();
							return false;
						}
					}
				}
			}
		}
	});
}


//更改非融合套餐
function updateNoChargePrice(){
	var noChargePrice=$("#copyPrice").val();//非融合套餐加格
	var stoped=0;//是否使用
	if("未启用"==$(".state .on").html()){
		stoped=1;
	}	
	var priceName=$(".amend>ul>li>lable").text();//套餐名称
	var id=$("#ulConfig .on").attr("value");//场所id
	var priceTypeNum=$(".amend>ul>.payMold>input").val();//非融合套餐收费类型
	var price_type=$(".new_price_type").val(); //套餐类型 分别代表时日月
	$.ajax({
		type:"post",
		url:ctx+"/SitePriceBilling/updateNoChargePrice",
		data:{
			priceName: priceName,
			noChargePrice:noChargePrice,
			stoped:stoped,
			siteId:id,
			price_num:priceTypeNum,
			price_type:price_type
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				$(".win>span").html("更改成功");
				winHint();
				$(".priceName:eq("+updateNum+")").attr("paytype",price_type);
				$(".priceName:eq("+updateNum+")").attr("value",priceTypeNum);
				$(".lastPrice:eq("+updateNum+") span").html(noChargePrice);
			}else{
				$(".win>span").html("服务不可用,请稍后重试");
				winHint();
			}
		}
	});
}

//更改收费价格
function updateChargePrice(){ 
	var noChargePrice=$("#copyPrice").val();//非融合套餐价格
	var priceTypeNum=$(".amend>ul>.payMold>input").val();//非融合套餐收费类型
	var chargePrice=$(".amend .setMeal input").val();//融合套餐收费价格
	var stoped=0;//0代表未停用的列表,1代表已停用的列表
	if("未启用"==$(".state .on").html()){
		stoped=1;
	}	
	var newCharge_type=$(".new_charge_type").val();//新的套餐归属集团
	var id=$("#ulConfig .on").attr("value");//场所id
	var priceName=$(".amend>ul>li>lable").text();//套餐名称
	var price_type=$(".new_price_type").val(); //套餐类型分别代表 时日月
	var comboNumber= "";//套餐号码段
	$(".amend .comboNumList input").each(function(){
		if($(this).val()!=""){
			comboNumber+=$(this).val()+";";
		}
	});
	var hasOrNo=0;//0代表没有融合套餐,如果打开融合套餐需要添加融合套餐.1代表修改非融合套餐和融合套餐
	if(stoped==0){
		if($(".useList .chargeInfo:eq("+updateNum+")>ul").length>0){
			hasOrNo=1;
		}
	}else{
		if($(".blockList .chargeInfo:eq("+updateNum+")>ul").length>0){
			hasOrNo=1;
		}
	}
	$.ajax({
		type:"post",
		url:ctx+"/SitePriceBilling/updateprice",
		data:{
			priceName: priceName,
			chargePrice:chargePrice,
			noChargePrice:noChargePrice,
			newCharge_type:newCharge_type,
			siteId:id,
			comboNumber:comboNumber,
			price_num:priceTypeNum,
			price_type:price_type,
			hasOrNo:hasOrNo,
			stoped:stoped
		},
		success:function(data){
			eval("data="+data);
			if(data.code==200){
				updateTwoResult(noChargePrice,chargePrice,newCharge_type,comboNumber,hasOrNo,priceTypeNum,price_type,stoped);
				$(".win>span").html("更改成功");
				winHint();
				return false;
			}else{
				$(".win>span").html("服务不可用，请稍后再试");
				winHint();
				return false;
					
			}
		}
	});
	
}
//修改后,展现在列表的内容
function updateTwoResult(noChargePrice,chargePrice,newCharge_type,comboNumber,hasOrNo,priceTypeNum,price_type,stoped){
	//未停用的修改展示页面
	if(stoped==0){
		if(hasOrNo==1){
			$(".priceName:eq("+updateNum+")").attr("paytype",price_type);
			$(".priceName:eq("+updateNum+")").attr("value",priceTypeNum);
			$(".lastPrice:eq("+updateNum+") span").html(noChargePrice);
			$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")>span").html(chargePrice);
			$(".useList .chargeInfo:eq("+updateNum+")>ul>.dnseg span").html(comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1));
			$(".useList .chargeInfo:eq("+updateNum+")>ul>.dnseg").attr("title",comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1));
			if(newCharge_type==1){
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("电信集团");
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","1");
			}
			if(newCharge_type==2){
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("移动集团");
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","2");
			}
			if(newCharge_type==3){
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("联通集团");
				$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","3");
			}
		}else{
			$(".useList>div:eq("+updateNum+")").attr("class","fuseCombo");
			$(".lastPrice:eq("+updateNum+") span").html(noChargePrice);
			var htmlPrice="";
				htmlPrice+="<ul>";
			if(newCharge_type==1){	
				htmlPrice+="<li id='chargeLi' value="+1+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>电信集团</span></li>";
			}
			if(newCharge_type==2){	
				htmlPrice+="<li id='chargeLi' value="+2+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>移动集团</span></li>";
			}
			if(newCharge_type==3){	
				htmlPrice+="<li id='chargeLi' value="+3+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>联通集团</span></li>";
			}
			htmlPrice+="<li class='dnseg' title="+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+">套餐号段：<span>"+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+"</span></li>";
			htmlPrice+="</ul>";
			$(".useList .chargeInfo:eq("+updateNum+")>p.lastPrice").after(htmlPrice);
		}
	 }else{//已停用的修改展示页面
		if(hasOrNo==1){
			$(".priceStopedName:eq("+updateNum+")").attr("paytype",price_type);
			$(".priceStopedName:eq("+updateNum+")").attr("value",priceTypeNum);
			$(".lastStopedPrice:eq("+updateNum+") span").html(noChargePrice);
			$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")>span").html(chargePrice);
			$(".blockList .chargeInfo:eq("+updateNum+")>ul>.dnseg span").html(comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1));
			$(".blockList .chargeInfo:eq("+updateNum+")>ul>.dnseg").attr("title",comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1));
			if(newCharge_type==1){
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("电信集团");
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","1");
			}
			if(newCharge_type==2){
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("移动集团");
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","2");
			}
			if(newCharge_type==3){
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+1+") span").html("联通集团");
				$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value","3");
			}
		}else{
			$(".blockList>div:eq("+updateNum+")").attr("class","fuseCombo");
			$(".lastStopedPrice:eq("+updateNum+") span").html(noChargePrice);
			var htmlPrice="";
				htmlPrice+="<ul>";
			if(newCharge_type==1){	
				htmlPrice+="<li id='chargeLi' value="+1+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>电信集团</span></li>";
			}
			if(newCharge_type==2){	
				htmlPrice+="<li id='chargeLi' value="+2+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>移动集团</span></li>";
			}
			if(newCharge_type==3){	
				htmlPrice+="<li id='chargeLi' value="+3+">套餐收费：<span>"+chargePrice+"元</span></li>";
				htmlPrice+="<li>所属集团：<span>联通集团</span></li>";
			}
			htmlPrice+="<li class='dnseg' title="+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+">套餐号段：<span>"+comboNumber.replace(/;/g , ',').substring(0,comboNumber.replace(/;/g , ',').length-1)+"</span></li>";
			htmlPrice+="</ul>";
			$(".blockList .chargeInfo:eq("+updateNum+")>p.lastStopedPrice").after(htmlPrice);
		}
	}
	
	$(".amend .newAppNum").remove();
	$(".amend .appendNum").before('<input type="text"  value="" placeholder="如:138211" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" maxlength="7" >');
	wouldClick();
}
function numdisp(n){
	if(n==0){
		$('.num').css('display','none');
		$('.num').eq(0).css('display','block');
		$('.num').eq(1).css('display','block');
		$('.num').eq(2).css('display','block');
		$('.num').eq(3).css('display','block');
	}else if(n==$('.num').length-1){
		$('.num').css('display','none');
		$('.num').eq(n-3).css('display','block');
		$('.num').eq(n-2).css('display','block');
		$('.num').eq(n-1).css('display','block');
		$('.num').eq(n).css('display','block');
	}else if(n==$('.num').length-2){
		$('.num').css('display','none');
		$('.num').eq(n-1).css('display','block');
		$('.num').eq(n).css('display','block');
		$('.num').eq(n+1).css('display','block');
		$('.num').eq(n-2).css('display','block');
	}else{
		$('.num').css('display','none');
		$('.num').eq(n-1).css('display','block');
		$('.num').eq(n).css('display','block');
		$('.num').eq(n+1).css('display','block');
		$('.num').eq(n+2).css('display','block');
	}
}
function buffer(){
	$('.barcontainer').css('display','block');
	$('.barcontainer').fadeOut(800);
}
$('.addCombo').click(function(){
	$('.floa').css('display','block');
});
$('.btn').click(function(){
	$('.floa').css('display','none');
	$(".floa>input").val("");
	return false;
});
function win(){
	$('.win').css('display','block').fadeOut(5000);
};
function winHint(){
	$('.win').css('display','block').fadeOut(1500);
};
function wouldClick(){
	//停用按钮绑定事件
	$(".useList>div .on").unbind("click");
	$(".useList>div .on").click(function(){
		 divNum=$(".useList>div>span").index(this);
		$('.wether').css('display','block');
	});
	//启用按钮绑定事件
	$(".blockList>div .on").unbind("click");
	$(".blockList>div .on").click(function(){
		divUseNum=$(".blockList>div>span").index(this);
		$('.wether').css('display','block');
	});
	//未停用修改按钮绑定事件
	$(".useList > div > em.edit").unbind("click");
	$('.useList > div > em.edit').click(function(){
		
		updateNum=$(".useList>div>em.edit").index(this);
		$('.mask').css('display','block');
		$('.new').css('display','none');
		$('.amend').css('display','block');
		$(".amend>ul>li>lable").html($(".priceName:eq("+updateNum+") span").eq(0).text());
		copyPrice(updateNum);
		$('.newly').animate({left:'20%'},1000);
	});
	//已停用修改按钮绑定事件
	$(".blockList > div > em.edit").unbind("click");
	$('.blockList > div > em.edit').click(function(){
		updateNum=$(".blockList>div>.edit").index(this);
		$('.mask').css('display','block');
		$('.new').css('display','none');
		$('.amend').css('display','block');
		$(".amend>ul>li>lable").html($(".priceStopedName:eq("+updateNum+") span").eq(0).text());
		copyPrice(updateNum);
		$('.newly').animate({left:'20%'},1000);
	});
	if("yesOrNo"!=$(".yesOrNo").eq(0).attr("class")){
		$(".fn-btn").attr("disabled", true);
	}else{
		$(".fn-btn").attr("disabled", false);
	}
}
//给修改页面赋值
function copyPrice(updateNum){
	//已启用页面
	if("已启用"==$(".state .on").html()){
		var priceValue=$(".lastPrice:eq("+updateNum+") span").text().replace("元","").trim();//普通收费价格
		$(".amend>ul>li:eq("+1+")> #copyPrice").val(priceValue);
		$(".amend>ul>.payMold>input").val($(".priceName:eq("+updateNum+")").attr("value"));
		var payType=$(".priceName:eq("+updateNum+")").attr("paytype");//付费类型
		var chargeType=$(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value");//套餐类型
		var comber="";
		if(payType==0){
			$(".amend>ul>.payMold>span").html("时");
			$(".new_price_type").val(0);
		}
		if(payType==1){
			$(".amend>ul>.payMold>span").html("天");
			$(".new_price_type").val(1);
		}
		if(payType==2){
			$(".amend>ul>.payMold>span").html("月");
			$(".new_price_type").val(2);
		}
		if($(".useList .chargeInfo:eq("+updateNum+")>ul").length>0){
			comber=$(".useList .chargeInfo:eq("+updateNum+")>ul>.dnseg span").html();
			$(".yesOrNo").eq(1).removeClass("on");
			$('.PackageDetails').css('display','block');
			$(".amend .setMeal input").val($(".useList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")>span").text().replace("元","").trim());
			
			if(1==chargeType){
				$(".amend .groupList").html("中国电信");
				$(".new_charge_type").val(1);
			}
			if(2==chargeType){
				$(".amend .groupList").html("中国移动");
				$(".new_charge_type").val(2);
			}
			if(3==chargeType){
				$(".amend .groupList").html("中国联通");
				$(".new_charge_type").val(3);
			}
			var comInput="";
			if(comber!=""){
				for(var i=0;i<comber.split(",").length;i++){
					comInput+='<input type="text" class="newAppNum" value="'+comber.split(",")[i]+'" placeholder="如:138211" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" maxlength="7" >';
				}
				if(comInput!=""){
					$(".amend .comboNumList input").remove();
					$(".amend .comboNumList .appendNum").before(comInput);
				};
			};
		}else{
			$(".yesOrNo").eq(1).addClass("on");
			$('.PackageDetails').css('display','none');
			$(".amend .setMeal input").val("");
			$(".amend .comboNumList>input").val("");
			if(undefined==chargeType){
				$(".amend .groupList").html("无归属");
				$(".new_charge_type").val(0);
			}
		}
	}
	//未启用页面
	if("未启用"==$(".state .on").html()){
		
		var priceValue=$(".lastStopedPrice:eq("+updateNum+") span").text().replace("元","").trim();
		$(".amend>ul>li:eq("+1+")> #copyPrice").val(priceValue);
		$(".amend>ul>.payMold>input").val($(".priceStopedName:eq("+updateNum+")").attr("value"));
		var payType=$(".priceStopedName:eq("+updateNum+")").attr("paytype");//付费类型
		var chargeType=$(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")").attr("value");//套餐类型
		var comber="";
		if(payType==0){
			$(".amend>ul>.payMold>span").html("时");
			$(".new_price_type").val(0);
		}
		if(payType==1){
			$(".amend>ul>.payMold>span").html("天");
			$(".new_price_type").val(1);
		}
		if(payType==2){
			$(".amend>ul>.payMold>span").html("月");
			$(".new_price_type").val(2);
		}
		if($(".blockList .chargeInfo:eq("+updateNum+")>ul").length>0){
			comber=$(".blockList .chargeInfo:eq("+updateNum+")>ul>.dnseg").attr("title");
			$(".yesOrNo").eq(1).removeClass("on");
			$('.PackageDetails').css('display','block');
			$(".amend .setMeal input").val($(".blockList .chargeInfo:eq("+updateNum+")>ul>li:eq("+0+")>span").text().replace("元","").trim());
	
			if(1==chargeType){
				$(".amend .groupList").html("中国电信");
				$(".new_charge_type").val(1);
			}
			if(2==chargeType){
				$(".amend .groupList").html("中国移动");
				$(".new_charge_type").val(2);
			}
			if(3==chargeType){
				$(".amend .groupList").html("中国联通");
				$(".new_charge_type").val(3);
			}
			var comInput="";
			if(comber!=""){
				for(var i=0;i<comber.split(",").length;i++){
					comInput+='<input type="text" class="newAppNum" value="'+comber.split(",")[i]+'" placeholder="如:138211" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" maxlength="7" >';
				}
				if(comInput!=""){
					$(".amend .comboNumList input").remove();
					$(".amend .comboNumList .appendNum").before(comInput);
				};
			};
		}else{
			$(".yesOrNo").eq(1).addClass("on");
			$('.PackageDetails').css('display','none');
			$(".amend .setMeal input").val("");
			$(".amend .comboNumList>input").val("");
			if(undefined==chargeType){
				$(".amend .groupList").html("无归属");
				$(".new_charge_type").val(0);
			}
		}
	}	
	checkRepeat();	
}
//移除未停用套餐列表,添加在已停用的套餐列表
function removeMeal(){
	//$(".useList>div").eq(divNum).remove();
	$(".useList>div:eq("+divNum+")>.chargeInfo>p:eq(0)").attr("class","priceStopedName");
	$(".useList>div:eq("+divNum+")>.chargeInfo>p:eq(1)").attr("class","lastStopedPrice");
	$(".useList>div:eq("+divNum+")>span>label").html("启&nbsp;用");
	if($(".blockList>div").length==0){
		$(".blockList").html($(".useList>div").eq(divNum));
	}else{
		$(".blockList>div").eq(0).before($(".useList>div").eq(divNum));
	}
	wouldClick();
	return false;
}
//移除停用套餐列表,添加在未停用的套餐列表
function removeStopedMeal(){
	$(".blockList>div:eq("+divUseNum+")>.chargeInfo>p:eq(0)").attr("class","priceName");
	$(".blockList>div:eq("+divUseNum+")>.chargeInfo>p:eq(1)").attr("class","lastPrice");
	$(".blockList>div:eq("+divUseNum+")>span>label").html("停&nbsp;用");
	if($(".useList>div").length==0){
		$(".useList").html($(".blockList>div").eq(divUseNum));
	}else{
		$(".useList>div").eq(0).before($(".blockList>div").eq(divUseNum));
	}
	wouldClick();
	//$(".blockList>.fuseCombo").eq(divUseNum).remove();
	return false;
}
//修改页面收费类型 时,日,月 按钮绑定
$('.amend .payList>li').click(function(){
	var n=$('.payList>li').index(this);
	var str=$('.payList>li').eq(n).html();
	var type=$('.payList>li').eq(n).attr("value");
	$("#price_type").val(type);
	$('.payMold>span').html(str);
	if("时"==str){
		$(".new_price_type").val(0);
	}
	if("天"==str){
		$(".new_price_type").val(1);
	}
	if("月"==str){
		$(".new_price_type").val(2);
	}
	$('.payList').css('display','none');
	return false;
});
$('.amend .payMold>span').click(function(){
	if($('.payList').css('display')=="none"){
		$('.payList').css('display','block');
	}else{
		$('.payList').css('display','none');
	}
});
//修改页面归属集团选择按钮绑定
$('.amend .teamGroup>ul>li').click(function(){
	var obj=$('.amend .teamGroup>button');
	var n=$('.amend .teamGroup>ul>li').index(this);
	var str=$('.amend .teamGroup>ul>li').eq(n).html();
	if("中国电信"==str){
		$(".new_charge_type").val(1);
	}
	if("中国移动"==str){
		$(".new_charge_type").val(2);
	}
	if("中国联通"==str){
		$(".new_charge_type").val(3);
	}
	$('.amend .teamGroup>ul').css('display','none');
	obj.html(str);
	return false;
});
//修改页面归属集团选择按钮绑定
$('.charging .teamGroup>ul>li').click(function(){
	var obj=$('.charging .teamGroup>button');
	var n=$('.charging .teamGroup>ul>li').index(this);
	var str=$('.charging .teamGroup>ul>li').eq(n).html();
	if("中国电信"==str){
		$("#charge_type").val(1);
	}
	if("中国移动"==str){
		$("#charge_type").val(2);
	}
	if("中国联通"==str){
		$("#charge_type").val(3);
	}
	$('.teamGroup>ul').css('display','none');
	obj.html(str);
	return false;
});
$('.teamGroup').click(function(){
	var str=$('.charging .teamGroup>ul').css('display');
	if(str=='block'){
		$('.charging .teamGroup>ul').css('display','none');
	}else{
		$('.charging .teamGroup>ul').css('display','block');
	}
});
$('.amend .teamGroup').click(function(){
	var str=$('.amend .teamGroup>ul').css('display');
	if(str=='block'){
		$('.amend .teamGroup>ul').css('display','none');
	}else{
		$('.amend .teamGroup>ul').css('display','block');
	}
});
$('.whether>button').click(function(){
	var n=$('.whether>button').index(this);
	whetherDisp(n);
});
$('.wether>button').click(function(){
	var n=$('.wether>button').index(this);
	whetherSure(n);
});
function whetherDisp(n){
	if(n==0){//点---是
		$('.whether').css('display','none');
		$('.newly').animate({left:2000},1000);
		setTimeout(function(){
			$('.mask').css('display','none');
		},500); 
		$(".charging input").each(function(){
			$(this).val("");
		});
		$(".charging .newAppNum").remove();
		$("#price_type").val("0");
		$("#charge_type").val("1");
		$(".charging .groupList").html("中国电信");
		$(".charging .payMold>span").html("时");
		$(".charging .appNum").val("");
		$(".amend .comboNumList>input").remove();
		$(".amend .appendNum").before('<input type="text"  value="" placeholder="如:138211" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" maxlength="7" >');
		$('.fuseAdd>.yesOrNo').eq(0).addClass('on');
		$(".PackageDetails").css("display","none");
	}else{// 点--否
		$('.whether').css('display','none');
	}
};
function whetherSure(n){
	if(n==0){//点---是
		$('.wether').css('display','none');
		$('.newly').animate({left:2000},1000);
		setTimeout(function(){
			$('.mask').css('display','none');
		},500);
	//修改提交时的判断
	if($(".mask").css("display")!="none"){
		
		if("yesOrNo"!=$('.yesOrNo').eq(1).attr("class")&&updateSubmitCheck){
			updateNoChargePrice();
		}
		if("yesOrNo"==$('.yesOrNo').eq(1).attr("class")&&updateSubmitCheck){	
			updateChargePrice();	
		}	
	}else{
		//停用套餐	
		if("已启用"==$(".state .on").html()){
			updateStop();
		}
		//启用套餐
		if("未启用"==$(".state .on").html()){
			findOpenStop();
			if(returnFlag){
				updateNoStop();
			};
		};	
	};
	}else{// 点--否
		$('.wether').css('display','none');
	}
};

